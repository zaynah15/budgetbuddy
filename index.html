<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#FFB6C1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Spendora">
<title>Spendora - Your Wallet's Glow-Up</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#FFF8F2;--bg2:#fff;--card:#fff;--inp:#fdf9ff;--g1:#ffe2ee;--g2:#f0e4ff;--t1:#7c5a8a;--t2:#b09cc0;--t3:#c8aed8;--bd:#f0e2ff;--sh:rgba(180,140,200,.12);--shh:rgba(180,140,200,.25);--tr:#f0e4fa}
body.dark{--bg:#1a0a20;--bg2:#2d1a35;--card:#2d1a35;--inp:#3a2445;--g1:#2d1535;--g2:#1a0a20;--t1:#e8d0f0;--t2:#c8a8d8;--t3:#a888c0;--bd:#4a3455;--sh:rgba(0,0,0,.3);--shh:rgba(0,0,0,.5);--tr:#3a2a45}
body{background:var(--bg);font-family:'Nunito',sans-serif;-webkit-font-smoothing:antialiased;overscroll-behavior:none;-webkit-user-select:none;user-select:none;transition:background .3s}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}
input,textarea,select{-webkit-user-select:text;user-select:text}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--t3);border-radius:99px}
@keyframes pulse{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:1;transform:scale(1.08)}}
@keyframes wobble{from{transform:rotate(-8deg) scale(1.1)}to{transform:rotate(8deg) scale(1.1)}}
@keyframes glutton{from{transform:rotate(-14deg) scale(.88)}to{transform:rotate(14deg) scale(1.12)}}
@keyframes slideDown{from{opacity:0;transform:translateX(-50%) translateY(-24px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes slideUp{from{opacity:0;transform:translateX(-50%) translateY(24px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes sheetUp{from{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(.7)}to{opacity:1;transform:scale(1)}}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes slideRow{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
@keyframes blobA{from{transform:translateY(0) scale(1)}to{transform:translateY(-28px) scale(1.04)}}
@keyframes blobB{from{transform:translateY(0) scale(1)}to{transform:translateY(24px) scale(.97)}}
@keyframes bounce{0%,100%{transform:scale(1) translateY(0)}50%{transform:scale(1.1) translateY(-5px)}}
@keyframes float{from{transform:translateY(0)}to{transform:translateY(-15px)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
@keyframes starGlow{0%,100%{transform:scale(1) rotate(0);filter:drop-shadow(0 0 6px #FFB6C1)}50%{transform:scale(1.2) rotate(180deg);filter:drop-shadow(0 0 18px #FFB6C1)}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useCallback,useRef}=React;

const FB={apiKey:"AIzaSyAyIwTNZB0mYWYPViDiHhYQsrc-DTyWmrk",authDomain:"budgetbuddy-4168c.firebaseapp.com",projectId:"budgetbuddy-4168c",storageBucket:"budgetbuddy-4168c.firebasestorage.app",messagingSenderId:"943210794388",appId:"1:943210794388:web:88940dc98f36240ec7d381"};
let auth,db,FB_OK=false;
try{if(!firebase.apps.length)firebase.initializeApp(FB);auth=firebase.auth();db=firebase.firestore();FB_OK=true;try{db.enablePersistence({synchronizeTabs:true});}catch(e){}}catch(e){console.error(e);}

const CATS={food:{label:"Food",emoji:"ğŸœ",color:"#FFB6C1",dark:"#d4507a",lb:"#fff0f4",db:"#3d2535"},clothing:{label:"Clothing",emoji:"ğŸ‘—",color:"#B5D8FF",dark:"#3a85d4",lb:"#f0f6ff",db:"#252d45"},travel:{label:"Travel",emoji:"âœˆï¸",color:"#C1F0DC",dark:"#2aaa78",lb:"#f0fcf7",db:"#253d35"},education:{label:"Education",emoji:"ğŸ“š",color:"#E6E6FA",dark:"#6060c0",lb:"#f5f5ff",db:"#2d2d45"},hobbies:{label:"Hobbies",emoji:"ğŸ®",color:"#FFD6BA",dark:"#d4703a",lb:"#fff7f0",db:"#3d3025"}};
const DEF={food:2000,clothing:1500,travel:1000,education:1500,hobbies:800};
const NUDGES=["ğŸŒ¿ Eat intentionally.","ğŸ˜‹ Hungry or just bored?","ğŸ’­ Need or craving?","ğŸ Cook at home!","ğŸ§˜ Pause before you pay.","ğŸ’¡ Tomorrow-you is grateful."];

const ls={get:(k,fb)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):fb;}catch{return fb;}},set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v));}catch{}}};

function mkKey(d=new Date()){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;}
function mkName(d=new Date()){return d.toLocaleString("default",{month:"long",year:"numeric"});}
function initState(){const s={},b={};Object.keys(CATS).forEach(k=>{s[k]=0;b[k]=DEF[k];});return{budgets:b,spent:s,transactions:[],monthKey:mkKey(),monthName:mkName(),salary:0,yearlyLog:{},currentStar:null,timezoneSet:false};}
function calcStar(s,b){return Object.values(s).reduce((a,v)=>a+v,0)<=Object.values(b).reduce((a,v)=>a+v,0)?"pink":"black";}
function parseSMS(t){if(!t)return null;for(const r of[/Rs\.?\s*([\d,]+(?:\.\d{1,2})?)/i,/INR\.?\s*([\d,]+(?:\.\d{1,2})?)/i,/â‚¹\.?\s*([\d,]+(?:\.\d{1,2})?)/i]){const m=t.match(r);if(m){const n=parseFloat(m[1].replace(/,/g,''));if(n>0)return Math.round(n);}}return null;}
async function saveFB(uid,data){if(!FB_OK||!uid)return;try{await db.collection('users').doc(uid).set(JSON.parse(JSON.stringify(data)));}catch(e){console.error("save:",e);}}

let _nt=[];
function clearNT(){_nt.forEach(clearTimeout);_nt=[];}
function scheduleNT(name){clearNT();if(!('Notification' in window)||Notification.permission!=='granted')return;[[12,0],[16,0],[21,0],[23,0]].forEach(([h,m])=>{const t=new Date();t.setHours(h,m,0,0);if(t<=new Date())t.setDate(t.getDate()+1);const id=setTimeout(()=>{const n=new Notification(`Hey ${name} ğŸŒ¸`,{body:"Did you spend anything today?",icon:"logo.png",tag:"sp"});n.onclick=()=>{window.focus();window.dispatchEvent(new CustomEvent('open-quick-log'));n.close();};scheduleNT(name);},t-new Date());_nt.push(id);});}

function Blobs(){return <div style={{position:"fixed",inset:0,pointerEvents:"none",overflow:"hidden",zIndex:0}}>{[{s:320,t:-90,l:-90,c:"#FFB6C118",a:"blobA",d:18},{s:260,t:"58%",r:-70,c:"#B5D8FF20",a:"blobB",d:22},{s:200,b:-60,l:"20%",c:"#C1F0DC1a",a:"blobA",d:16},{s:180,t:"30%",l:"62%",c:"#E6E6FA22",a:"blobB",d:20}].map((b,i)=><div key={i} style={{position:"absolute",width:b.s,height:b.s,borderRadius:"50%",background:b.c,top:b.t,left:b.l,right:b.r,bottom:b.b,filter:"blur(50px)",animation:`${b.a} ${b.d}s ease-in-out infinite alternate`,animationDelay:`${i*2.8}s`}}/>)}</div>;}

function Toast({show,msg,type}){if(!show)return null;const bg=type==="error"?"linear-gradient(135deg,#ff6b6b,#ff8e6b)":type==="warn"?"linear-gradient(135deg,#ffb347,#ffd060)":type==="success"?"linear-gradient(135deg,#6fd4a8,#40c8a0)":"linear-gradient(135deg,#b5d8ff,#80b8ff)";return <div style={{position:"fixed",top:20,left:"50%",transform:"translateX(-50%)",background:bg,color:"white",padding:"12px 24px",borderRadius:999,fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:14,boxShadow:"0 8px 28px rgba(0,0,0,.18)",zIndex:9998,animation:"slideDown .35s cubic-bezier(.34,1.56,.64,1)",whiteSpace:"nowrap",maxWidth:"90vw",overflow:"hidden",textOverflow:"ellipsis"}}>{msg}</div>;}

function Confetti({on}){if(!on)return null;const cols=["#FFB6C1","#B5D8FF","#C1F0DC","#E6E6FA","#FFD6BA","#ffd700","#ff9de2","#a0f0c0"];return <div style={{position:"fixed",inset:0,pointerEvents:"none",zIndex:9999,overflow:"hidden"}}>{Array.from({length:50},(_,i)=><div key={i} style={{position:"absolute",top:-16,left:`${Math.random()*100}%`,width:7+Math.random()*7,height:7+Math.random()*7,borderRadius:Math.random()>.5?"50%":"3px",background:cols[i%cols.length],animation:`fall ${1.4+Math.random()*2}s ${Math.random()*.8}s ease-in forwards`,transform:`rotate(${Math.random()*360}deg)`}}/>)}</div>;}

function Ring({spent,budget,color,dark,emoji,label,onClick}){const pct=Math.min((spent/budget)*100,100),r=32,circ=2*Math.PI*r,dash=circ-(pct/100)*circ,over=spent>budget,warn=(budget-spent)<=300&&!over,stroke=over?"#ff6b6b":warn?"#ffb347":color;return <div onClick={onClick} style={{display:"flex",flexDirection:"column",alignItems:"center",gap:5,cursor:onClick?"pointer":"default",WebkitTapHighlightColor:"transparent"}}><div style={{position:"relative",width:76,height:76}}>{over&&<div style={{position:"absolute",inset:-4,borderRadius:"50%",background:"rgba(255,107,107,.15)",animation:"pulse 1.2s ease-in-out infinite"}}/>}<svg width={76} height={76} viewBox="0 0 76 76"><circle cx={38} cy={38} r={r} fill="none" stroke="var(--tr)" strokeWidth={7}/><circle cx={38} cy={38} r={r} fill="none" stroke={stroke} strokeWidth={7} strokeLinecap="round" strokeDasharray={circ} strokeDashoffset={dash} style={{transformOrigin:"50% 50%",transform:"rotate(-90deg)",transition:"stroke-dashoffset .8s cubic-bezier(.4,0,.2,1),stroke .4s"}}/></svg><div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:over?20:18,animation:over?"wobble .7s ease-in-out infinite alternate":"none"}}>{over?"ğŸ˜¡":emoji}</div></div><div style={{textAlign:"center"}}><div style={{fontWeight:800,fontSize:10,color:"var(--t2)",fontFamily:"'Nunito',sans-serif"}}>{label}</div><div style={{fontWeight:700,fontSize:9,fontFamily:"'Nunito',sans-serif",color:over?"#ff6b6b":"var(--t3)"}}>{over?`+â‚¹${spent-budget}`:`â‚¹${Math.max(0,budget-spent)} left`}</div></div></div>;}

function StarBadge({mName,star,hasSpent}){const pink=star==="pink";return <div style={{display:"flex",alignItems:"center",gap:8,background:pink?"linear-gradient(135deg,#FFB6C1,#ff9db0)":hasSpent?"linear-gradient(135deg,#4a3455,#2d1a35)":"linear-gradient(135deg,#e8e0f0,#d8d0e8)",borderRadius:999,padding:"8px 14px",boxShadow:"0 4px 16px rgba(255,182,193,.3)"}}><div style={{fontSize:22,animation:pink?"starGlow 2.5s ease-in-out infinite":"none",filter:pink?"none":hasSpent?"grayscale(1) brightness(.4)":"grayscale(1) brightness(.6)"}}>â­</div><div><div style={{fontWeight:800,fontSize:10,color:pink?"white":hasSpent?"#c8a8d8":"#9080a8",fontFamily:"'Nunito',sans-serif"}}>{mName.split(' ')[0]}</div><div style={{fontWeight:700,fontSize:9,color:pink?"white":hasSpent?"#a888c0":"#b0a0c0",fontFamily:"'Nunito',sans-serif"}}>{pink?"Pink Star âœ¨":hasSpent?"Black Star":"In Progress"}</div></div></div>;}

function CatSheet({amount,spent,budgets,onPick,onCancel,dark}){const [pr,setPr]=useState(null);return <div style={{position:"fixed",inset:0,background:dark?"rgba(0,0,0,.75)":"rgba(70,30,110,.42)",backdropFilter:"blur(10px)",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:9990,animation:"fadeIn .18s ease"}}><div style={{background:"var(--bg)",borderRadius:"28px 28px 0 0",padding:"0 0 40px",width:"100%",maxWidth:500,boxShadow:"0 -20px 70px var(--shh)",animation:"sheetUp .35s cubic-bezier(.25,.8,.25,1)"}}><div style={{padding:"14px 0 0",display:"flex",justifyContent:"center"}}><div style={{width:40,height:4,borderRadius:99,background:"var(--bd)"}}/></div><div style={{textAlign:"center",padding:"16px 20px 18px"}}><div style={{display:"inline-flex",alignItems:"center",gap:6,background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",borderRadius:999,padding:"10px 32px",boxShadow:"0 6px 20px rgba(255,182,193,.5)"}}><span style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:30,color:"white"}}>â‚¹{amount}</span></div><div style={{marginTop:12,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:"var(--t1)"}}>What was this for? ğŸ¤”</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:12,color:"var(--t2)",fontWeight:700,marginTop:3}}>Tap a bucket below</div></div><div style={{padding:"0 16px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:14}}>{Object.entries(CATS).map(([key,cat])=>{const rem=budgets[key]-spent[key],af=rem-amount,over=af<0,close=!over&&af<=300,p=pr===key;return <button key={key} onMouseDown={()=>setPr(key)} onMouseUp={()=>{setPr(null);onPick(key);}} onTouchStart={e=>{e.preventDefault();setPr(key);}} onTouchEnd={e=>{e.preventDefault();setPr(null);onPick(key);}} onMouseLeave={()=>setPr(null)} style={{border:`2.5px solid ${over?"#ff6b6b":p?cat.dark:cat.color}`,background:over?(dark?"#3a2530":"#fff5f5"):p?`${cat.color}70`:(dark?cat.db:cat.lb),borderRadius:20,padding:"15px 12px",display:"flex",alignItems:"center",gap:11,cursor:"pointer",transform:p?"scale(.95)":"scale(1)",transition:"all .15s ease",outline:"none",textAlign:"left",width:"100%",WebkitTapHighlightColor:"transparent"}}><span style={{fontSize:32,flexShrink:0,lineHeight:1,animation:p?"bounce .4s ease":"none"}}>{over?"ğŸ˜¡":cat.emoji}</span><div style={{flex:1,minWidth:0}}><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:14,color:p?cat.dark:"var(--t1)",marginBottom:3}}>{cat.label}</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:11,color:over?"#ff6b6b":close?"#e8900a":"var(--t2)"}}>{over?`+â‚¹${Math.abs(af)} over ğŸ˜¡`:close?`âš¡ â‚¹${af} left`:`â‚¹${af} left`}</div><div style={{marginTop:5,height:4,borderRadius:99,background:"rgba(0,0,0,.06)",overflow:"hidden"}}><div style={{height:"100%",borderRadius:99,background:over?"#ff6b6b":close?"#ffb347":`linear-gradient(90deg,${cat.color},${cat.dark})`,width:`${Math.min(((spent[key]+Number(amount))/budgets[key])*100,100)}%`}}/></div></div></button>})}</div><div style={{padding:"0 16px"}}><button onClick={onCancel} style={{width:"100%",border:"2px solid var(--bd)",background:"var(--bg2)",borderRadius:16,padding:13,fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:14,color:"var(--t3)",cursor:"pointer",WebkitTapHighlightColor:"transparent"}}>Cancel âœ•</button></div></div></div>;}

function GluttonModal({cat,overspent,lost,onClose,dark}){if(!cat)return null;const c=CATS[cat];return <div onClick={onClose} style={{position:"fixed",inset:0,background:dark?"rgba(0,0,0,.75)":"rgba(100,50,140,.45)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9997,animation:"fadeIn .2s ease"}}><div onClick={e=>e.stopPropagation()} style={{background:"var(--card)",borderRadius:32,padding:"36px 28px",textAlign:"center",maxWidth:340,width:"90%",boxShadow:"0 32px 80px var(--shh)",animation:"popIn .4s cubic-bezier(.34,1.56,.64,1)"}}><div style={{fontSize:72,animation:"glutton .7s ease-in-out infinite alternate",lineHeight:1.1}}>ğŸ˜¡</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:22,fontWeight:900,color:"#ff6b6b",marginTop:12}}>Budget Busted!</div><div style={{background:"#fff0f0",border:"2px solid #ff6b6b",borderRadius:16,padding:"12px 16px",marginTop:12,fontFamily:"'Nunito',sans-serif",fontSize:18,fontWeight:900,color:"#ff6b6b"}}>+â‚¹{overspent} overspent ğŸ˜¡</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:14,color:"var(--t2)",marginTop:14,lineHeight:1.7}}>You crossed your <strong style={{color:c.dark}}>{c.label}</strong> budget.{lost>0&&<><br/><strong style={{color:"#ff6b6b"}}>This way you won't be able to save â‚¹{lost} this month.</strong></>}<br/>Come on, you're better than this!!</div><button onClick={onClose} style={{marginTop:20,background:"linear-gradient(135deg,#ff6b6b,#ff8e53)",color:"white",border:"none",borderRadius:999,padding:"12px 28px",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:15,cursor:"pointer",boxShadow:"0 4px 16px rgba(255,107,107,.5)"}}>I'll do better ğŸ’ª</button></div></div>;}

function Nudge({show,msg,onClose}){if(!show)return null;return <div style={{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",background:"linear-gradient(135deg,#fff8f2,#ffe8f5)",border:"2px solid #FFB6C1",borderRadius:20,padding:"13px 20px",fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:700,color:"#c06080",boxShadow:"0 8px 30px rgba(255,182,193,.3)",zIndex:9996,animation:"slideUp .4s cubic-bezier(.34,1.56,.64,1)",display:"flex",alignItems:"center",gap:10,maxWidth:"88vw"}}><span style={{fontSize:20}}>ğŸŒ¿</span>{msg}<span onClick={onClose} style={{marginLeft:8,cursor:"pointer",fontSize:16,color:"#e8a0b0",fontWeight:900}}>âœ•</span></div>;}

function QuickLog({onLog,onSkip,dark}){const [a,setA]=useState("");const [c,setC]=useState(null);const ref=useRef(null);useEffect(()=>{setTimeout(()=>ref.current&&ref.current.focus(),100);},[]);return <div style={{position:"fixed",inset:0,background:dark?"rgba(0,0,0,.75)":"rgba(70,30,110,.45)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,animation:"fadeIn .2s ease",padding:20}}><div style={{background:"var(--card)",borderRadius:28,padding:"28px 24px",width:"100%",maxWidth:380,boxShadow:"0 32px 80px var(--shh)",animation:"popIn .4s cubic-bezier(.34,1.56,.64,1)"}}><div style={{textAlign:"center",marginBottom:20}}><div style={{fontSize:46,marginBottom:8}}>ğŸ’¸</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:18,color:"var(--t1)"}}>Log a Spend</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:13,color:"var(--t2)",fontWeight:700,marginTop:2}}>Enter amount &amp; pick category</div></div><div style={{display:"flex",alignItems:"center",border:"2px solid var(--bd)",borderRadius:16,background:"var(--inp)",overflow:"hidden",marginBottom:14}}><span style={{padding:"0 12px",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:20,color:"#c8a0e0"}}>â‚¹</span><input ref={ref} type="number" placeholder="0" value={a} onChange={e=>setA(e.target.value)} onKeyDown={e=>e.key==="Enter"&&c&&onLog(Number(a),c)} style={{flex:1,border:"none",outline:"none",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:26,color:"var(--t1)",background:"transparent",padding:"12px 8px"}}/></div><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:16}}>{Object.entries(CATS).map(([k,cat])=><button key={k} onClick={()=>setC(k)} style={{border:`2px solid ${c===k?cat.dark:cat.color}`,background:c===k?`${cat.color}60`:(dark?cat.db:cat.lb),borderRadius:14,padding:"10px 6px",display:"flex",flexDirection:"column",alignItems:"center",gap:4,cursor:"pointer",transform:c===k?"scale(1.06)":"scale(1)",transition:"all .2s ease",WebkitTapHighlightColor:"transparent"}}><span style={{fontSize:24}}>{cat.emoji}</span><span style={{fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:10,color:c===k?cat.dark:"var(--t2)"}}>{cat.label}</span></button>)}</div><div style={{display:"flex",gap:8}}><button onClick={onSkip} style={{flex:1,border:"2px solid var(--bd)",background:"var(--bg2)",borderRadius:14,padding:12,fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:14,color:"var(--t3)",cursor:"pointer"}}>Skip</button><button onClick={()=>a&&c&&onLog(Number(a),c)} disabled={!a||!c} style={{flex:1,background:(a&&c)?"linear-gradient(135deg,#FFB6C1,#c8a0e0)":"#e8ddf0",border:"none",borderRadius:14,padding:12,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:14,color:(a&&c)?"white":"#c8b8d8",cursor:(a&&c)?"pointer":"not-allowed",boxShadow:(a&&c)?"0 4px 16px rgba(255,182,193,.5)":"none"}}>Log It âœ“</button></div></div></div>;}

function History({txns,dark}){if(!txns.length)return <div style={{textAlign:"center",padding:"32px 16px",color:"var(--t3)",fontFamily:"'Nunito',sans-serif"}}><img src="logo.png" alt="" style={{width:56,height:56,marginBottom:10,opacity:.4}}/><div style={{fontWeight:700,fontSize:14}}>No transactions yet!</div><div style={{fontSize:12,marginTop:4}}>Log your first spend above.</div></div>;return <div style={{maxHeight:320,overflowY:"auto",paddingRight:2}}>{[...txns].reverse().map((t,i)=>{const c=CATS[t.category];if(!c)return null;return <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",marginBottom:8,background:"var(--bg2)",borderRadius:16,boxShadow:"0 2px 10px var(--sh)",border:`1.5px solid ${c.color}40`,animation:i===0?"slideRow .3s ease":"none"}}><div style={{width:38,height:38,borderRadius:12,background:`${c.color}45`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}}>{c.emoji}</div><div style={{flex:1}}><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:13,color:"var(--t1)"}}>{c.label}</div>{t.note&&<div style={{fontFamily:"'Nunito',sans-serif",fontSize:11,color:"var(--t2)",fontStyle:"italic"}}>{t.note}</div>}<div style={{fontFamily:"'Nunito',sans-serif",fontSize:10,color:"var(--t3)"}}>{t.time}</div></div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:"#e86090"}}>-â‚¹{t.amount}</div></div>;})}</div>;}

function BucketHist({catKey,txns,mName,onClose,dark}){const c=CATS[catKey],filt=txns.filter(t=>t.category===catKey),tot=filt.reduce((a,t)=>a+t.amount,0);return <div onClick={onClose} style={{position:"fixed",inset:0,background:dark?"rgba(0,0,0,.75)":"rgba(70,30,110,.45)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9995,animation:"fadeIn .2s ease",padding:20}}><div onClick={e=>e.stopPropagation()} style={{background:"var(--card)",borderRadius:28,padding:"28px 24px",width:"100%",maxWidth:420,maxHeight:"80vh",boxShadow:"0 32px 80px var(--shh)",animation:"popIn .4s cubic-bezier(.34,1.56,.64,1)",display:"flex",flexDirection:"column"}}><div style={{marginBottom:16,flexShrink:0}}><div style={{display:"flex",alignItems:"center",gap:12,marginBottom:4}}><div style={{width:48,height:48,borderRadius:14,background:`${c.color}40`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:26}}>{c.emoji}</div><div style={{flex:1}}><h3 style={{fontFamily:"'Nunito',sans-serif",fontSize:19,fontWeight:900,color:"var(--t1)"}}>{c.label} Â· {mName.split(' ')[0]}</h3><div style={{fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:700,color:"var(--t2)"}}>{filt.length} transaction{filt.length!==1?"s":""} Â· â‚¹{tot} total</div></div><button onClick={onClose} style={{background:"none",border:"none",fontSize:24,color:"var(--t3)",cursor:"pointer"}}>âœ•</button></div></div><div style={{flex:1,overflowY:"auto",paddingRight:4}}>{filt.length===0?<div style={{textAlign:"center",padding:"40px 20px",color:"var(--t3)"}}><div style={{fontSize:40,marginBottom:12}}>{c.emoji}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:700}}>No {c.label.toLowerCase()} transactions yet</div></div>:[...filt].reverse().map((t,i)=><div key={i} style={{padding:12,marginBottom:10,background:dark?c.db:c.lb,border:`1.5px solid ${c.color}40`,borderRadius:14,animation:i===0?"slideRow .3s ease":"none"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div style={{flex:1}}><div style={{fontFamily:"'Nunito',sans-serif",fontSize:10,fontWeight:700,color:"var(--t3)"}}>{t.time}</div>{t.note&&<div style={{fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:700,color:"var(--t2)",marginTop:3}}>{t.note}</div>}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:18,fontWeight:900,color:"#e86090"}}>-â‚¹{t.amount}</div></div></div>)}</div></div></div>;}

function YearlyReport({log,onMonth,onClose,dark}){const sorted=Object.keys(log).sort().reverse(),pink=sorted.filter(k=>log[k].star==="pink").length;return <div style={{position:"fixed",inset:0,background:"var(--bg)",zIndex:9994,overflowY:"auto",animation:"fadeIn .2s ease"}}><div style={{maxWidth:500,margin:"0 auto",padding:"20px 20px 40px"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24,paddingTop:8}}><h2 style={{fontFamily:"'Nunito',sans-serif",fontSize:24,fontWeight:900,background:"linear-gradient(135deg,#c06080,#9b6dbd)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>Yearly Report ğŸ“Š</h2><button onClick={onClose} style={{background:"var(--card)",border:"none",borderRadius:"50%",width:42,height:42,fontSize:20,color:"var(--t1)",cursor:"pointer",boxShadow:"0 4px 16px var(--sh)"}}>âœ•</button></div>{sorted.length>0&&<div style={{background:"var(--card)",borderRadius:20,padding:20,marginBottom:20,boxShadow:"0 4px 20px var(--sh)",display:"flex",gap:16}}><div style={{flex:1,textAlign:"center",padding:12,background:dark?"#3a2445":"#fff0f4",borderRadius:14}}><div style={{fontSize:28,animation:"starGlow 2.5s ease-in-out infinite"}}>â­</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:24,color:"#FFB6C1"}}>{pink}</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:700,fontSize:11,color:"var(--t2)"}}>Pink Stars</div></div><div style={{flex:1,textAlign:"center",padding:12,background:dark?"#3a2445":"#f5f0ff",borderRadius:14}}><div style={{fontSize:28,filter:"grayscale(1) brightness(.3)"}}>â­</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:24,color:"var(--t1)"}}>{sorted.length-pink}</div><div style={{fontFamily:"'Nunito',sans-serif",fontWeight:700,fontSize:11,color:"var(--t2)"}}>Black Stars</div></div></div>}{sorted.length===0?<div style={{textAlign:"center",padding:"60px 20px",background:"var(--card)",borderRadius:24,boxShadow:"0 8px 32px var(--sh)"}}><div style={{fontSize:60,marginBottom:16}}>ğŸ“…</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:16,fontWeight:800,color:"var(--t1)",marginBottom:8}}>No completed months yet</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:700,color:"var(--t2)"}}>Keep tracking to build your yearly log!</div></div>:sorted.map(k=>{const d=log[k];return <div key={k} onClick={()=>onMonth(k,d)} style={{background:"var(--card)",borderRadius:20,padding:20,marginBottom:14,boxShadow:"0 4px 20px var(--sh)",cursor:"pointer",border:`2px solid ${d.star==="pink"?"#FFB6C1":dark?"#4a3455":"#e0d8f0"}`}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{flex:1}}><div style={{fontFamily:"'Nunito',sans-serif",fontSize:17,fontWeight:900,color:"var(--t1)",marginBottom:4}}>{d.monthName}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:700,color:"var(--t2)"}}>Saved: â‚¹{Math.max(0,d.saved||0).toLocaleString()} Â· Spent: â‚¹{(d.totalSpent||0).toLocaleString()}</div></div><div style={{fontSize:36,filter:d.star==="pink"?"none":"grayscale(1) brightness(.3)",animation:d.star==="pink"?"starGlow 2.5s ease-in-out infinite":"none"}}>â­</div></div></div>;})}</div></div>;}

function MonthDetail({data,onClose,dark}){if(!data)return null;return <div style={{position:"fixed",inset:0,background:"var(--bg)",zIndex:9995,overflowY:"auto",animation:"fadeIn .2s ease"}}><div style={{maxWidth:500,margin:"0 auto",padding:"20px 20px 40px"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20,paddingTop:8}}><h2 style={{fontFamily:"'Nunito',sans-serif",fontSize:20,fontWeight:900,color:"var(--t1)"}}>{data.monthName}</h2><button onClick={onClose} style={{background:"var(--card)",border:"none",borderRadius:"50%",width:40,height:40,fontSize:20,color:"var(--t1)",cursor:"pointer",boxShadow:"0 4px 16px var(--sh)"}}>âœ•</button></div><div style={{background:data.star==="pink"?"linear-gradient(135deg,#FFB6C1,#ff9db0)":"linear-gradient(135deg,#4a3455,#2d1a35)",borderRadius:20,padding:20,marginBottom:20,display:"flex",alignItems:"center",gap:16,color:"white"}}><div style={{fontSize:52,filter:data.star==="pink"?"none":"grayscale(1) brightness(.6)",animation:data.star==="pink"?"starGlow 2.5s ease-in-out infinite":"none"}}>â­</div><div style={{flex:1}}><div style={{fontFamily:"'Nunito',sans-serif",fontSize:17,fontWeight:900,marginBottom:4}}>{data.star==="pink"?"Pink Star Earned! ğŸ‰":"Black Star"}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:700,opacity:.9}}>{data.star==="pink"?"Stayed within budget!":"Overspent this month"}</div></div></div><div style={{background:"var(--card)",borderRadius:20,padding:20,marginBottom:16,boxShadow:"0 4px 20px var(--sh)"}}><h3 style={{fontFamily:"'Nunito',sans-serif",fontSize:15,fontWeight:900,color:"var(--t1)",marginBottom:14}}>Summary</h3>{[["Income",`â‚¹${(data.salary||0).toLocaleString()}`,false,null],["Total Budget",`â‚¹${(data.totalBudget||0).toLocaleString()}`,false,null],["Total Spent",`â‚¹${(data.totalSpent||0).toLocaleString()}`,true,null],["Saved",`â‚¹${Math.max(0,data.saved||0).toLocaleString()}`,false,data.saved>=0]].map(([label,val,red,good])=><div key={label} style={{display:"flex",justifyContent:"space-between",padding:"11px 14px",borderRadius:12,marginBottom:8,background:good!=null?(good?"linear-gradient(135deg,#6fd4a8,#40c8a0)":"linear-gradient(135deg,#ff6b6b,#ff8e53)"):(dark?"#3a2445":"#f9f6ff")}}><span style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:800,color:good!=null?"white":"var(--t2)"}}>{label}</span><span style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:900,color:good!=null?"white":red?"#e86090":"var(--t1)"}}>{val}</span></div>)}</div><div style={{background:"var(--card)",borderRadius:20,padding:20,boxShadow:"0 4px 20px var(--sh)"}}><h3 style={{fontFamily:"'Nunito',sans-serif",fontSize:15,fontWeight:900,color:"var(--t1)",marginBottom:14}}>Category Breakdown</h3>{Object.entries(CATS).map(([k,c])=>{const sp=(data.spent||{})[k]||0,bd=(data.budgets||{})[k]||0;return <div key={k} style={{display:"flex",alignItems:"center",gap:12,padding:11,marginBottom:8,background:dark?c.db:c.lb,border:`1.5px solid ${c.color}40`,borderRadius:12}}><span style={{fontSize:22}}>{c.emoji}</span><div style={{flex:1}}><div style={{fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:800,color:"var(--t1)"}}>{c.label}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:11,fontWeight:700,color:"var(--t2)"}}>â‚¹{sp.toLocaleString()} / â‚¹{bd.toLocaleString()}</div></div><div style={{fontSize:11,fontWeight:800,fontFamily:"'Nunito',sans-serif",color:sp>bd?"#ff6b6b":"#6fd4a8"}}>{sp>bd?"Over":"OK"}</div></div>;})}</div></div></div>;}

function TimezoneSetup({onComplete}){const [country,setCountry]=useState("");const [tz,setTz]=useState(Intl.DateTimeFormat().resolvedOptions().timeZone||"");const ok=country.trim()&&tz;return <div style={{minHeight:"100dvh",background:"var(--bg)",display:"flex",alignItems:"center",justifyContent:"center",padding:20}}><Blobs/><div style={{background:"var(--card)",borderRadius:32,padding:"40px 32px",maxWidth:420,width:"100%",boxShadow:"0 32px 80px var(--shh)",animation:"popIn .5s cubic-bezier(.34,1.56,.64,1)",position:"relative",zIndex:1}}><div style={{textAlign:"center",marginBottom:28}}><div style={{fontSize:52,marginBottom:12}}>ğŸŒ</div><h2 style={{fontFamily:"'Nunito',sans-serif",fontSize:22,fontWeight:900,color:"var(--t1)",marginBottom:8}}>One-time Setup</h2><p style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:700,color:"var(--t2)"}}>This only appears once ever</p></div><div style={{marginBottom:18}}><label style={{display:"block",fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:800,color:"var(--t2)",marginBottom:7,textTransform:"uppercase",letterSpacing:.5}}>Country</label><input type="text" placeholder="e.g. India" value={country} onChange={e=>setCountry(e.target.value)} style={{width:"100%",border:"2px solid var(--bd)",borderRadius:14,padding:"12px 16px",fontFamily:"'Nunito',sans-serif",fontSize:15,fontWeight:700,color:"var(--t1)",background:"var(--inp)",outline:"none"}}/></div><div style={{marginBottom:28}}><label style={{display:"block",fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:800,color:"var(--t2)",marginBottom:7,textTransform:"uppercase",letterSpacing:.5}}>Timezone</label><select value={tz} onChange={e=>setTz(e.target.value)} style={{width:"100%",border:"2px solid var(--bd)",borderRadius:14,padding:"12px 16px",fontFamily:"'Nunito',sans-serif",fontSize:15,fontWeight:700,color:"var(--t1)",background:"var(--inp)",outline:"none"}}><option value="">Select...</option><option value="Asia/Kolkata">Asia/Kolkata (IST) ğŸ‡®ğŸ‡³</option><option value="Asia/Dubai">Asia/Dubai (GST) ğŸ‡¦ğŸ‡ª</option><option value="America/New_York">America/New_York (EST) ğŸ‡ºğŸ‡¸</option><option value="America/Los_Angeles">America/Los_Angeles (PST) ğŸ‡ºğŸ‡¸</option><option value="Europe/London">Europe/London (GMT) ğŸ‡¬ğŸ‡§</option><option value="Asia/Singapore">Asia/Singapore (SGT) ğŸ‡¸ğŸ‡¬</option><option value="Australia/Sydney">Australia/Sydney (AEDT) ğŸ‡¦ğŸ‡º</option><option value="Asia/Tokyo">Asia/Tokyo (JST) ğŸ‡¯ğŸ‡µ</option></select></div><button onClick={()=>ok&&onComplete(country.trim(),tz)} disabled={!ok} style={{width:"100%",background:ok?"linear-gradient(135deg,#FFB6C1,#c8a0e0)":"#e8ddf0",border:"none",borderRadius:999,padding:14,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:ok?"white":"#c8b8d8",cursor:ok?"pointer":"not-allowed",boxShadow:ok?"0 6px 20px rgba(255,182,193,.5)":"none"}}>Continue â†’</button></div></div>;}

function SalarySetup({initBudgets,onComplete}){const [salary,setSalary]=useState("");const [budgets,setBudgets]=useState(initBudgets);const [step,setStep]=useState(1);const total=Object.values(budgets).reduce((a,b)=>a+b,0);const proj=Number(salary)-total;const sok=salary&&Number(salary)>0;return <div style={{minHeight:"100dvh",background:"var(--bg)",padding:20,overflowY:"auto"}}><div style={{maxWidth:460,margin:"0 auto",paddingTop:40}}><div style={{textAlign:"center",marginBottom:28}}><img src="logo.png" alt="" style={{width:80,height:80,marginBottom:14}}/><h2 style={{fontFamily:"'Nunito',sans-serif",fontSize:24,fontWeight:900,background:"linear-gradient(135deg,#c06080,#9b6dbd)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:6}}>Monthly Budget Setup</h2><p style={{fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:700,color:"var(--t2)"}}>Step {step} of 2</p></div>{step===1?<div style={{background:"var(--card)",borderRadius:24,padding:"28px 24px",boxShadow:"0 8px 32px var(--sh)"}}><div style={{fontSize:44,textAlign:"center",marginBottom:12}}>ğŸ’°</div><h3 style={{fontFamily:"'Nunito',sans-serif",fontSize:18,fontWeight:900,color:"var(--t1)",textAlign:"center",marginBottom:20}}>What is your income this month?</h3><div style={{display:"flex",alignItems:"center",border:"2px solid var(--bd)",borderRadius:16,background:"var(--inp)",overflow:"hidden",marginBottom:20}}><span style={{padding:"0 16px",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:26,color:"#c8a0e0"}}>â‚¹</span><input type="number" placeholder="0" value={salary} onChange={e=>setSalary(e.target.value)} onKeyDown={e=>e.key==="Enter"&&sok&&setStep(2)} autoFocus style={{flex:1,border:"none",outline:"none",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:32,color:"var(--t1)",background:"transparent",padding:"16px 12px"}}/></div><button onClick={()=>sok&&setStep(2)} disabled={!sok} style={{width:"100%",background:sok?"linear-gradient(135deg,#FFB6C1,#c8a0e0)":"#e8ddf0",border:"none",borderRadius:999,padding:14,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:sok?"white":"#c8b8d8",cursor:sok?"pointer":"not-allowed",boxShadow:sok?"0 6px 20px rgba(255,182,193,.5)":"none"}}>Next â†’</button></div>:<div><div style={{background:"var(--card)",borderRadius:24,padding:24,boxShadow:"0 8px 32px var(--sh)",marginBottom:16}}><h3 style={{fontFamily:"'Nunito',sans-serif",fontSize:17,fontWeight:900,color:"var(--t1)",marginBottom:18,textAlign:"center"}}>Set Budget Per Category</h3>{Object.entries(CATS).map(([k,c])=><div key={k} style={{marginBottom:12,padding:14,border:`2px solid ${c.color}`,borderRadius:16,background:c.lb}}><div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}><span style={{fontSize:22}}>{c.emoji}</span><label style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:900,color:"var(--t1)"}}>{c.label}</label></div><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontFamily:"'Nunito',sans-serif",fontSize:18,fontWeight:900,color:c.dark}}>â‚¹</span><input type="number" value={budgets[k]} onChange={e=>setBudgets({...budgets,[k]:Number(e.target.value)})} style={{flex:1,border:`1.5px solid ${c.color}`,borderRadius:10,padding:"10px 12px",fontFamily:"'Nunito',sans-serif",fontSize:16,fontWeight:800,color:"var(--t1)",background:"var(--inp)",outline:"none"}}/></div></div>)}</div><div style={{background:proj>=0?"linear-gradient(135deg,#6fd4a8,#40c8a0)":"linear-gradient(135deg,#ff6b6b,#ff8e53)",borderRadius:20,padding:"18px 20px",marginBottom:16}}><div style={{fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:800,color:"white",marginBottom:4,opacity:.9}}>{proj>=0?"If you stick to these budgets, you will save:":"Budget exceeds income by:"}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:34,fontWeight:900,color:"white"}}>â‚¹{Math.abs(proj).toLocaleString()}</div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:700,color:"white",marginTop:6,opacity:.85}}>{proj>=0?"this month ğŸ’ª":"reduce your budgets âš ï¸"}</div></div><div style={{display:"flex",gap:8}}><button onClick={()=>setStep(1)} style={{flex:0,border:"2px solid var(--bd)",background:"var(--card)",borderRadius:14,padding:"14px 20px",fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:14,color:"var(--t2)",cursor:"pointer"}}>â† Back</button><button onClick={()=>onComplete(Number(salary),budgets)} style={{flex:1,background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",border:"none",borderRadius:14,padding:14,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:"white",cursor:"pointer",boxShadow:"0 6px 20px rgba(255,182,193,.5)"}}>Start Tracking âœ¨</button></div></div>}</div></div>;}

function SignIn(){const [loading,setLoading]=useState(false);const [err,setErr]=useState(null);const go=async()=>{if(!FB_OK){setErr("Firebase not configured.");return;}setLoading(true);setErr(null);try{await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());}catch(e){setErr(e.code==='auth/popup-closed-by-user'?"Sign-in cancelled.":e.code==='auth/unauthorized-domain'?"Domain not authorized â€” add zaynah15.github.io to Firebase Console â†’ Auth â†’ Settings â†’ Authorized Domains":"Sign-in failed: "+e.message);setLoading(false);}};return <div style={{minHeight:"100dvh",background:"linear-gradient(160deg,var(--g1) 0%,var(--g2) 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:20,position:"relative",overflow:"hidden"}}><Blobs/><div style={{background:"var(--card)",borderRadius:32,padding:"48px 36px",maxWidth:420,width:"100%",boxShadow:"0 32px 80px var(--shh)",textAlign:"center",animation:"popIn .5s cubic-bezier(.34,1.56,.64,1)",position:"relative",zIndex:1}}><img src="logo.png" alt="Spendora" style={{width:120,height:120,marginBottom:20,animation:"float 3s ease-in-out infinite alternate"}}/><h1 style={{fontFamily:"'Nunito',sans-serif",fontSize:32,fontWeight:900,background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:6}}>Spendora</h1><p style={{fontFamily:"'Nunito',sans-serif",fontSize:16,fontWeight:800,color:"var(--t2)",marginBottom:32,lineHeight:1.5}}>Your Wallet's Glow-Up. ğŸ’–</p>{!FB_OK&&<div style={{background:"#fff3cd",border:"2px solid #ffc107",borderRadius:16,padding:12,marginBottom:20,fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:700,color:"#856404",textAlign:"left"}}>âš ï¸ Firebase not configured.</div>}{err&&<div style={{background:"#fff0f0",border:"2px solid #ff6b6b",borderRadius:16,padding:12,marginBottom:20,fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:700,color:"#ff6b6b"}}>{err}</div>}<button onClick={go} disabled={loading||!FB_OK} style={{width:"100%",background:(loading||!FB_OK)?"#e8ddf0":"white",border:"2px solid var(--bd)",borderRadius:16,padding:"16px 24px",fontFamily:"'Nunito',sans-serif",fontSize:16,fontWeight:900,color:(loading||!FB_OK)?"#c8b8d8":"var(--t1)",cursor:(loading||!FB_OK)?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:12,boxShadow:"0 4px 16px var(--sh)",transition:"all .2s ease"}}>{loading?<><div style={{width:20,height:20,border:"3px solid #e8ddf0",borderTopColor:"#9b6dbd",borderRadius:"50%",animation:"spin .8s linear infinite"}}/>Signing in...</>:<><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Continue with Google</>}</button><div style={{marginTop:24,fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:700,color:"var(--t3)",lineHeight:1.6}}>Sign in to sync across all your devices ğŸ¤</div></div></div>;}

function EditBudgets({budgets,onChange,onSave}){return <div style={{maxWidth:420,margin:"0 auto",padding:"28px 18px"}}><div style={{textAlign:"center",marginBottom:22}}><img src="logo.png" alt="" style={{width:72,height:72,marginBottom:12}}/><h2 style={{fontSize:22,fontWeight:900,background:"linear-gradient(135deg,#c06080,#9b6dbd)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontFamily:"'Nunito',sans-serif"}}>Edit Budgets</h2></div>{Object.entries(CATS).map(([k,c])=><div key={k} style={{background:"var(--card)",borderRadius:20,padding:"14px 16px",marginBottom:10,boxShadow:"0 4px 16px var(--sh)",border:`2px solid ${c.color}`,display:"flex",alignItems:"center",gap:12}}><span style={{fontSize:26,flexShrink:0}}>{c.emoji}</span><div style={{flex:1}}><label style={{fontWeight:800,color:"var(--t1)",fontSize:13,display:"block",marginBottom:5,fontFamily:"'Nunito',sans-serif"}}>{c.label}</label><div style={{display:"flex",alignItems:"center",gap:5}}><span style={{fontWeight:900,color:c.dark,fontSize:16}}>â‚¹</span><input type="number" value={budgets[k]} onChange={e=>onChange(k,Number(e.target.value))} style={{border:`1.5px solid ${c.color}`,borderRadius:10,padding:"8px 10px",fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:16,width:"100%",outline:"none",color:"var(--t1)",background:"var(--inp)"}}/></div></div></div>)}<button onClick={onSave} style={{width:"100%",marginTop:10,background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",color:"white",border:"none",borderRadius:999,padding:15,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:17,cursor:"pointer",boxShadow:"0 8px 24px rgba(255,182,193,.5)"}}>Save Changes âœ“</button></div>;}

function Spendora(){
  const [user,setUser]=useState(null);
  const [authLoading,setAuthLoading]=useState(true);
  const [state,setState]=useState(initState);
  const [theme,setTheme]=useState(()=>ls.get('sp_theme','light'));
  const [syncing,setSyncing]=useState(false);
  const [screen,setScreen]=useState("main");
  const [tab,setTab]=useState("log");
  const [amount,setAmount]=useState("");
  const [note,setNote]=useState("");
  const [pending,setPending]=useState(null);
  const [toast,setToast]=useState({show:false,msg:"",type:"info"});
  const [glut,setGlut]=useState(null);
  const [nudge,setNudge]=useState({show:false,msg:""});
  const [confetti,setConfetti]=useState(false);
  const [editBud,setEditBud]=useState(null);
  const [notif,setNotif]=useState(()=>ls.get('sp_notif',{enabled:false}).enabled);
  const [quickLog,setQuickLog]=useState(false);
  const [needsTZ,setNeedsTZ]=useState(false);
  const [needsSal,setNeedsSal]=useState(false);
  const [yearlyV,setYearlyV]=useState(false);
  const [mDetail,setMDetail]=useState(null);
  const [bucketCat,setBucketCat]=useState(null);
  const inputRef=useRef(null);
  const saveTimer=useRef(null);
  const fbUnsub=useRef(null);
  const firstLoad=useRef(true);
  const setupLock=useRef(false); // CRITICAL: blocks Firestore overwrites during setup
  const dark=theme==='dark';

  useEffect(()=>{document.body.classList.toggle('dark',dark);ls.set('sp_theme',theme);},[theme,dark]);

  const toast_=useCallback((msg,type="info",dur=3000)=>{
    setToast({show:true,msg,type});
    setTimeout(()=>setToast(t=>({...t,show:false})),dur);
  },[]);

  const rollover=useCallback((data)=>{
    const cur=mkKey();
    if(!data.monthKey||data.monthKey===cur)return data;
    const star=calcStar(data.spent,data.budgets);
    const ts=Object.values(data.spent).reduce((a,b)=>a+b,0);
    const tb=Object.values(data.budgets).reduce((a,b)=>a+b,0);
    const newLog={...data.yearlyLog,[data.monthKey]:{star,spent:{...data.spent},budgets:{...data.budgets},transactions:[...data.transactions],salary:data.salary,totalSpent:ts,totalBudget:tb,saved:(data.salary||0)-ts,monthName:data.monthName}};
    const ns={};Object.keys(CATS).forEach(k=>{ns[k]=0;});
    toast_(star==="pink"?`ğŸ‰ ${data.monthName} done! Pink Star â­`:`ğŸ“Š ${data.monthName} done. Black Star!`,"success",5000);
    return{...data,monthKey:cur,monthName:mkName(),spent:ns,transactions:[],salary:0,yearlyLog:newLog,currentStar:null};
  },[toast_]);

  useEffect(()=>{
    if(!FB_OK){setAuthLoading(false);return;}
    const unsub=auth.onAuthStateChanged(fu=>{
      setAuthLoading(false);
      if(fu){
        setUser({uid:fu.uid,email:fu.email,displayName:fu.displayName,photoURL:fu.photoURL});
        setSyncing(true);
        if(fbUnsub.current)fbUnsub.current();
        fbUnsub.current=db.collection('users').doc(fu.uid).onSnapshot(doc=>{
          setSyncing(false);
          // â˜… KEY FIX: if setup flow is running, IGNORE Firestore updates
          if(setupLock.current)return;
          if(doc.exists){
            const raw=doc.data();
            if(firstLoad.current){
              firstLoad.current=false;
              const d=rollover(raw);
              setState(d);
              if(d!==raw)saveFB(fu.uid,d);
              // timezone stored IN the Firestore doc â€” never repeats
              if(!d.timezoneSet){setNeedsTZ(true);}
              else if(!d.salary||d.salary===0){setNeedsSal(true);}
            }else{
              setState(prev=>{
                const incoming=raw;
                if((incoming.transactions||[]).length>=(prev.transactions||[]).length)return incoming;
                return prev;
              });
            }
          }else{
            firstLoad.current=false;
            const d=initState();
            saveFB(fu.uid,d);setState(d);setNeedsTZ(true);
          }
        },err=>{setSyncing(false);console.error(err);toast_("Sync error","error");});
      }else{
        setUser(null);setState(initState());
        if(fbUnsub.current){fbUnsub.current();fbUnsub.current=null;}
        firstLoad.current=true;setupLock.current=false;
      }
    });
    return()=>{unsub();if(fbUnsub.current)fbUnsub.current();};
  },[rollover,toast_]);

  // Save to Firestore â€” only when setupLock is OFF
  useEffect(()=>{
    if(!user||!FB_OK||setupLock.current)return;
    if(saveTimer.current)clearTimeout(saveTimer.current);
    saveTimer.current=setTimeout(()=>saveFB(user.uid,state),800);
    return()=>{if(saveTimer.current)clearTimeout(saveTimer.current);};
  },[state,user]);

  useEffect(()=>{const id=setInterval(()=>{setState(prev=>{const d=rollover(prev);if(d!==prev&&user)saveFB(user.uid,d);return d;});},60000);return()=>clearInterval(id);},[rollover,user]);
  useEffect(()=>{if(notif&&user){scheduleNT(user.displayName?.split(' ')[0]||'friend');}else clearNT();return()=>clearNT();},[notif,user]);
  useEffect(()=>{const h=()=>setQuickLog(true);window.addEventListener('open-quick-log',h);if('serviceWorker' in navigator)navigator.serviceWorker.addEventListener('message',e=>{if(e.data?.type==='OPEN_QUICK_LOG')setQuickLog(true);});return()=>window.removeEventListener('open-quick-log',h);},[]);
  useEffect(()=>{const p=new URLSearchParams(window.location.search),t=p.get('text');if(t){const n=parseSMS(t);if(n){setPending(n);toast_(`âœ¨ â‚¹${n} from SMS!`,"success");}window.history.replaceState({},'',window.location.pathname);}},[]); // eslint-disable-line

  const enableNotif=async()=>{if(!('Notification' in window)){toast_("Not supported","error");return;}const p=await Notification.requestPermission();if(p==='granted'){setNotif(true);ls.set('sp_notif',{enabled:true});toast_("ğŸ”” Enabled!","success");}else{setNotif(false);ls.set('sp_notif',{enabled:false});toast_("Blocked â€” enable in browser settings","error");}};
  const disableNotif=()=>{setNotif(false);ls.set('sp_notif',{enabled:false});clearNT();toast_("ğŸ”• Off","info");};
  const handleAdd=()=>{const a=Number(amount);if(!a||a<=0){toast_("Enter a valid amount ğŸ™ˆ","warn");inputRef.current&&inputRef.current.focus();return;}setPending(a);};
  const handlePaste=async()=>{try{const t=await navigator.clipboard.readText();const n=parseSMS(t);if(n){setPending(n);toast_(`âœ¨ â‚¹${n}!`,"success");}else toast_("No amount found ğŸ˜•","warn");}catch{toast_("Couldn't read clipboard","error");}};

  const handlePick=useCallback((catKey,custom=null)=>{
    const amt=custom!==null?custom:pending;
    setPending(null);if(!amt||amt<=0)return;
    localStorage.setItem('sp_today',new Date().toDateString());
    const bud=state.budgets[catKey],nsp=state.spent[catKey]+amt,rem=bud-nsp,over=nsp>bud;
    const ns={...state,spent:{...state.spent,[catKey]:nsp},transactions:[...state.transactions,{category:catKey,amount:amt,note:note.trim()||null,time:new Date().toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}]};
    ns.currentStar=calcStar(ns.spent,ns.budgets);
    setState(ns);setAmount("");setNote("");
    if(over){if(navigator.vibrate)navigator.vibrate([200,100,200,100,400]);const tb=Object.values(ns.budgets).reduce((a,b)=>a+b,0);setTimeout(()=>setGlut({cat:catKey,overspent:nsp-bud,lost:Math.max(0,(state.salary||0)-tb)}),150);}
    else if(rem<=300){if(navigator.vibrate)navigator.vibrate([150,100,150]);toast_(`âš¡ Only â‚¹${Math.max(0,rem)} left in ${CATS[catKey].label}!`,"warn");if(catKey==="food")setTimeout(()=>setNudge({show:true,msg:NUDGES[Math.floor(Math.random()*NUDGES.length)]}),700);}
    else if(nsp>bud*.5){toast_(`ğŸ’¡ Halfway through ${CATS[catKey].label}!`,"info");}
    else{toast_(`âœ… â‚¹${amt} logged!`,"success");}
    if(Object.keys(CATS).every(k=>(k===catKey?nsp:state.spent[k])<=ns.budgets[k])&&Object.values(ns.spent).some(s=>s>0)){setTimeout(()=>{setConfetti(true);setTimeout(()=>setConfetti(false),3500);},400);}
  },[pending,state,note,toast_]);

  const signOut=async()=>{if(!window.confirm("Sign out?"))return;try{await auth.signOut();}catch{toast_("Sign out failed","error");}};
  const ts=Object.values(state.spent).reduce((a,b)=>a+b,0);
  const tb=Object.values(state.budgets).reduce((a,b)=>a+b,0);
  const pct=tb>0?Math.min((ts/tb)*100,100):0;
  const star=state.currentStar||calcStar(state.spent,state.budgets);
  const savings=(state.salary||0)-ts;

  if(authLoading)return <div style={{minHeight:"100dvh",background:"linear-gradient(160deg,var(--g1) 0%,var(--g2) 100%)",display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{textAlign:"center"}}><img src="logo.png" alt="" style={{width:90,height:90,marginBottom:16,animation:"pulse 1.5s ease-in-out infinite"}}/><div style={{fontFamily:"'Nunito',sans-serif",fontSize:18,fontWeight:800,color:"var(--t2)"}}>Loading...</div></div></div>;
  if(!user)return <SignIn/>;

  // â”€ Timezone: one-time, stored in Firestore, NEVER repeats â”€
  if(needsTZ)return <TimezoneSetup onComplete={(country,tz)=>{
    setupLock.current=true;
    const ns={...state,timezoneSet:true,country,timezone:tz};
    setState(ns);setNeedsTZ(false);setNeedsSal(true);
    saveFB(user.uid,ns).finally(()=>{setTimeout(()=>{setupLock.current=false;},1500);});
  }}/>;

  // â”€ Salary: shown when salary=0 â”€
  if(needsSal)return <SalarySetup initBudgets={state.budgets} onComplete={(sal,bud)=>{
    setupLock.current=true;
    const ns={...state,salary:sal,budgets:bud};
    setState(ns);setNeedsSal(false);
    saveFB(user.uid,ns).finally(()=>{setTimeout(()=>{setupLock.current=false;},1500);});
  }}/>;

  if(yearlyV&&!mDetail)return <YearlyReport log={state.yearlyLog} onMonth={(_,d)=>setMDetail(d)} onClose={()=>setYearlyV(false)} dark={dark}/>;
  if(mDetail)return <MonthDetail data={mDetail} onClose={()=>setMDetail(null)} dark={dark}/>;

  if(screen==="edit")return <div style={{minHeight:"100dvh",background:"var(--bg)",position:"relative"}}><Blobs/><div style={{position:"relative",zIndex:1}}><div style={{padding:"18px 18px 0"}}><button onClick={()=>setScreen("main")} style={{background:"var(--bg2)",border:"none",borderRadius:999,padding:"8px 18px",fontFamily:"'Nunito',sans-serif",fontWeight:800,color:"var(--t1)",cursor:"pointer",boxShadow:"0 2px 12px var(--sh)",fontSize:14}}>â† Back</button></div><EditBudgets budgets={editBud||state.budgets} onChange={(k,v)=>setEditBud(p=>({...(p||state.budgets),[k]:v}))} onSave={()=>{setState(p=>({...p,budgets:editBud||p.budgets}));setScreen("main");toast_("âœ¨ Budgets updated!","success");}}/></div></div>;

  return(
    <div style={{minHeight:"100dvh",background:"var(--bg)",position:"relative"}}>
      <Blobs/><Confetti on={confetti}/><Toast {...toast}/>
      {glut&&<GluttonModal cat={glut.cat} overspent={glut.overspent} lost={glut.lost} onClose={()=>setGlut(null)} dark={dark}/>}
      <Nudge show={nudge.show} msg={nudge.msg} onClose={()=>setNudge({show:false,msg:""})}/>
      {bucketCat&&<BucketHist catKey={bucketCat} txns={state.transactions} mName={state.monthName} onClose={()=>setBucketCat(null)} dark={dark}/>}
      {quickLog&&<QuickLog onLog={(a,c)=>{handlePick(c,a);setQuickLog(false);}} onSkip={()=>setQuickLog(false)} dark={dark}/>}
      {pending!==null&&<CatSheet amount={pending} spent={state.spent} budgets={state.budgets} onPick={handlePick} onCancel={()=>setPending(null)} dark={dark}/>}

      <button onClick={()=>setTheme(t=>t==='light'?'dark':'light')} style={{position:"fixed",top:20,right:20,zIndex:10001,width:46,height:46,borderRadius:"50%",background:dark?"linear-gradient(135deg,#FFB6C1,#ffd700)":"linear-gradient(135deg,#4a4a6a,#2d2d4a)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,boxShadow:"0 4px 16px var(--sh)",transition:"all .3s"}}>{dark?'â˜€ï¸':'ğŸŒ™'}</button>
      <button onClick={notif?disableNotif:enableNotif} style={{position:"fixed",top:74,right:20,zIndex:10001,width:46,height:46,borderRadius:"50%",background:notif?"linear-gradient(135deg,#6fd4a8,#40c8a0)":"linear-gradient(135deg,#ff6b6b,#ff8e53)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,boxShadow:"0 4px 16px var(--sh)",transition:"all .3s",animation:notif?"":"shake 2s ease-in-out infinite"}}>{notif?'ğŸ””':'ğŸ”•'}</button>
      <div style={{position:"fixed",top:20,left:20,zIndex:10001,display:"flex",alignItems:"center",gap:10,background:"var(--card)",padding:"8px 14px 8px 8px",borderRadius:999,boxShadow:"0 4px 16px var(--sh)"}}><img src={user.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName||'U')}&background=FFB6C1&color=fff&size=72`} alt="" style={{width:34,height:34,borderRadius:"50%",border:"2.5px solid #FFB6C1"}}/><div><div style={{fontFamily:"'Nunito',sans-serif",fontSize:13,fontWeight:900,color:"var(--t1)"}}>{user.displayName?.split(' ')[0]||'Friend'}</div><button onClick={signOut} style={{fontFamily:"'Nunito',sans-serif",fontSize:10,fontWeight:700,color:"var(--t3)",background:"none",border:"none",cursor:"pointer",padding:0}}>Sign Out</button></div></div>
      {syncing&&<div style={{position:"fixed",bottom:16,right:16,zIndex:10001,background:"var(--card)",padding:"8px 14px",borderRadius:999,boxShadow:"0 4px 16px var(--sh)",fontFamily:"'Nunito',sans-serif",fontSize:12,fontWeight:700,color:"var(--t2)",display:"flex",alignItems:"center",gap:8}}><div style={{width:11,height:11,border:"2px solid var(--t3)",borderTopColor:"#FFB6C1",borderRadius:"50%",animation:"spin .8s linear infinite"}}/>Syncing...</div>}

      <div style={{maxWidth:500,margin:"0 auto",position:"relative",zIndex:1,paddingBottom:36,paddingTop:82}}>
        <div style={{background:"linear-gradient(160deg,var(--g1) 0%,var(--g2) 100%)",padding:"24px 18px 18px",borderRadius:"0 0 30px 30px",boxShadow:"0 8px 30px var(--sh)",position:"relative",overflow:"hidden"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div>
              <div style={{fontSize:10,fontWeight:800,color:"var(--t3)",letterSpacing:2,textTransform:"uppercase",fontFamily:"'Nunito',sans-serif"}}>Spendora</div>
              <h1 style={{margin:"4px 0 2px",fontSize:20,fontWeight:900,background:"linear-gradient(135deg,#c06080,#9b6dbd)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontFamily:"'Nunito',sans-serif"}}>Hi, {user.displayName?.split(' ')[0]||'Friend'}! ğŸ‘‹</h1>
              <div style={{fontSize:11,color:"var(--t2)",fontWeight:700,fontFamily:"'Nunito',sans-serif"}}>{state.monthName}</div>
            </div>
            <StarBadge mName={state.monthName} star={star} hasSpent={ts>0}/>
          </div>
          <div style={{marginTop:16}}>
            <div style={{display:"flex",justifyContent:"space-between",marginBottom:5}}><span style={{fontSize:11,fontWeight:800,color:"var(--t1)",fontFamily:"'Nunito',sans-serif"}}>â‚¹{ts.toLocaleString()} / â‚¹{tb.toLocaleString()}</span><span style={{fontSize:11,fontWeight:700,color:"var(--t2)",fontFamily:"'Nunito',sans-serif"}}>{pct.toFixed(0)}% used</span></div>
            <div style={{background:dark?"#3a2a45":"white",borderRadius:999,height:9,overflow:"hidden",boxShadow:"inset 0 2px 6px var(--sh)"}}><div style={{height:"100%",borderRadius:999,background:pct>=90?"linear-gradient(90deg,#ff6b6b,#ff8e53)":pct>=60?"linear-gradient(90deg,#ffb347,#ffd700)":"linear-gradient(90deg,#FFB6C1,#c8a0e0)",width:`${pct}%`,transition:"width .7s cubic-bezier(.4,0,.2,1)"}}/></div>
          </div>
          {state.salary>0&&<div style={{marginTop:12,padding:"10px 14px",borderRadius:14,background:savings>=0?(dark?"rgba(111,212,168,.15)":"rgba(111,212,168,.2)"):(dark?"rgba(255,107,107,.15)":"rgba(255,107,107,.1)"),border:`1.5px solid ${savings>=0?"#6fd4a8":"#ff6b6b"}40`,display:"flex",alignItems:"center",justifyContent:"space-between"}}><span style={{fontFamily:"'Nunito',sans-serif",fontSize:11,fontWeight:800,color:"var(--t2)"}}>{savings>=0?"On track to save:":"Overspent by:"}</span><span style={{fontFamily:"'Nunito',sans-serif",fontSize:14,fontWeight:900,color:savings>=0?"#40c8a0":"#ff6b6b"}}>â‚¹{Math.abs(savings).toLocaleString()}</span></div>}
        </div>

        <div style={{padding:"20px 18px 0"}}>
          <div style={{display:"flex",justifyContent:"space-around",gap:4}}>{Object.entries(CATS).map(([k,c])=><Ring key={k} spent={state.spent[k]} budget={state.budgets[k]} color={c.color} dark={c.dark} emoji={c.emoji} label={c.label} onClick={()=>setBucketCat(k)}/>)}</div>
          <div style={{textAlign:"center",marginTop:6}}><span style={{fontFamily:"'Nunito',sans-serif",fontSize:10,fontWeight:700,color:"var(--t3)"}}>Tap a ring to see history</span></div>
        </div>

        <div style={{padding:"16px 18px 0",display:"flex",gap:8}}>{["log","history"].map(t=><button key={t} onClick={()=>setTab(t)} style={{flex:1,border:"none",borderRadius:14,padding:"10px 0",fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:13,cursor:"pointer",background:tab===t?"linear-gradient(135deg,#FFB6C1,#c8a0e0)":"var(--bg2)",color:tab===t?"white":"var(--t2)",boxShadow:tab===t?"0 4px 16px rgba(255,182,193,.4)":"0 2px 10px var(--sh)",transition:"all .25s ease",WebkitTapHighlightColor:"transparent"}}>{t==="log"?"ğŸ’¸ Log Spend":`ğŸ“‹ ${state.monthName.split(' ')[0]} History`}</button>)}</div>

        {tab==="log"&&<div style={{padding:"14px 18px"}}><div style={{background:"var(--card)",borderRadius:22,padding:20,marginBottom:12,boxShadow:"0 4px 24px var(--sh)"}}><button onClick={handlePaste} style={{width:"100%",marginBottom:14,background:dark?"linear-gradient(135deg,#3a2445,#2d1a35)":"linear-gradient(135deg,#f0e4ff,#ffe8f5)",border:`2px dashed ${dark?"#6050a0":"#d8b8f0"}`,borderRadius:16,padding:12,fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:14,color:"var(--t1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><span style={{fontSize:20}}>ğŸ“‹</span>Paste SMS to Auto-Fill</button><div style={{fontSize:10,fontWeight:800,color:"var(--t2)",marginBottom:7,letterSpacing:.5,textTransform:"uppercase",fontFamily:"'Nunito',sans-serif"}}>Or enter manually</div><div style={{display:"flex",gap:8,alignItems:"stretch",marginBottom:14}}><div style={{display:"flex",alignItems:"center",flex:1,border:"2px solid var(--bd)",borderRadius:16,background:"var(--inp)",overflow:"hidden"}}><span style={{padding:"0 12px",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:22,color:"#c8a0e0"}}>â‚¹</span><input ref={inputRef} type="number" placeholder="0" value={amount} onChange={e=>setAmount(e.target.value)} onKeyDown={e=>e.key==="Enter"&&handleAdd()} style={{flex:1,border:"none",outline:"none",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:28,color:"var(--t1)",background:"transparent",padding:"14px 8px"}}/></div><button onClick={handleAdd} style={{background:"linear-gradient(135deg,#FFB6C1,#c8a0e0)",border:"none",borderRadius:16,padding:"0 22px",fontFamily:"'Nunito',sans-serif",fontWeight:900,fontSize:16,color:"white",cursor:"pointer",boxShadow:"0 4px 16px rgba(255,182,193,.5)",whiteSpace:"nowrap",WebkitTapHighlightColor:"transparent"}}>Add â•</button></div><div style={{fontSize:10,fontWeight:800,color:"var(--t2)",marginBottom:6,letterSpacing:.5,textTransform:"uppercase",fontFamily:"'Nunito',sans-serif"}}>Note (optional)</div><input type="text" placeholder="e.g. Lunch, Uber..." value={note} onChange={e=>setNote(e.target.value)} maxLength={60} style={{width:"100%",border:"1.5px solid var(--bd)",borderRadius:12,padding:"10px 14px",fontFamily:"'Nunito',sans-serif",fontWeight:700,fontSize:13,color:"var(--t1)",background:"var(--inp)",outline:"none"}}/></div></div>}

        {tab==="history"&&<div style={{padding:"14px 18px"}}><div style={{background:"var(--card)",borderRadius:22,padding:18,boxShadow:"0 4px 24px var(--sh)"}}><History txns={state.transactions} dark={dark}/></div></div>}

        <div style={{padding:"0 18px",display:"flex",gap:8}}>
          <button onClick={()=>{setEditBud({...state.budgets});setScreen("edit");}} style={{flex:1,border:`2px solid ${CATS.education.color}`,background:"var(--bg2)",borderRadius:14,padding:12,fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:12,color:"var(--t1)",cursor:"pointer"}}>âš™ï¸ Edit Budgets</button>
          <button onClick={()=>setYearlyV(true)} style={{flex:1,border:`2px solid ${CATS.hobbies.color}`,background:"var(--bg2)",borderRadius:14,padding:12,fontFamily:"'Nunito',sans-serif",fontWeight:800,fontSize:12,color:"var(--t1)",cursor:"pointer"}}>ğŸ“Š Yearly Report</button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<Spendora/>);
if('serviceWorker' in navigator)window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').catch(e=>console.log('SW:',e)));
</script>
</body>
</html>
